{"ast":null,"code":"// Replace your RouteVisualizer component with this fixed version\nimport React,{useState,useEffect}from'react';import{Polyline,Circle}from'react-leaflet';import{jsx as _jsx,Fragment as _Fragment,jsxs as _jsxs}from\"react/jsx-runtime\";const RouteVisualizer=_ref=>{let{route}=_ref;const[isAnimating,setIsAnimating]=useState(false);const[animationProgress,setAnimationProgress]=useState(0);// Helper function to safely extract coordinates\nconst extractCoordinates=coord=>{if(!coord)return null;// Handle different coordinate formats\nif(Array.isArray(coord)&&coord.length>=2){// Ensure coordinates are numbers\nconst lat=parseFloat(coord[0]);const lng=parseFloat(coord[1]);// Validate coordinates\nif(isNaN(lat)||isNaN(lng)){console.warn('Invalid coordinates:',coord);return null;}return[lat,lng];}if(coord.lat!==undefined&&coord.lng!==undefined){const lat=parseFloat(coord.lat);const lng=parseFloat(coord.lng);if(isNaN(lat)||isNaN(lng)){console.warn('Invalid coordinates:',coord);return null;}return[lat,lng];}console.warn('Unknown coordinate format:',coord);return null;};// Convert route path to valid coordinates\nconst getValidPath=()=>{if(!route||!route.path){console.warn('Route or route.path is missing');return[];}const validPath=route.path.map(coord=>extractCoordinates(coord)).filter(coord=>coord!==null);console.log('Original path:',route.path);console.log('Valid path:',validPath);return validPath;};// Convert route locations to valid coordinates\nconst getValidLocations=()=>{if(!route||!route.locations){console.warn('Route or route.locations is missing');return[];}const validLocations=route.locations.map(location=>{const coords=extractCoordinates(location.coordinates);return coords?{...location,coordinates:coords}:null;}).filter(location=>location!==null);console.log('Original locations:',route.locations);console.log('Valid locations:',validLocations);return validLocations;};// Animation effect\nuseEffect(()=>{if(!route)return;setIsAnimating(true);const duration=3000;// 3 seconds\nconst startTime=Date.now();const animate=()=>{const elapsed=Date.now()-startTime;const progress=Math.min(elapsed/duration,1);setAnimationProgress(progress);if(progress<1){requestAnimationFrame(animate);}else{setIsAnimating(false);}};animate();},[route]);// Get visible path based on animation progress\nconst getVisiblePath=()=>{const fullPath=getValidPath();if(fullPath.length===0)return[];if(!isAnimating)return fullPath;const visiblePointCount=Math.floor(fullPath.length*animationProgress);return fullPath.slice(0,Math.max(visiblePointCount,1));};// Get travel dot position\nconst getTravelDotPosition=()=>{const fullPath=getValidPath();if(fullPath.length===0||!isAnimating)return null;const targetIndex=Math.floor((fullPath.length-1)*animationProgress);return fullPath[targetIndex];};if(!route){console.warn('RouteVisualizer: No route provided');return null;}const validPath=getValidPath();const validLocations=getValidLocations();if(validPath.length===0){console.error('RouteVisualizer: No valid path coordinates found');return null;}const visiblePath=getVisiblePath();const travelDotPosition=getTravelDotPosition();// Define styles\nconst polylineOptions={color:route.color||'#e91e63',weight:4,opacity:0.8,lineJoin:'round',dashArray:route.dashArray||null,className:'route-path'};const stationCircleOptions={radius:6,fillColor:'#fff',color:route.color||'#e91e63',weight:2,opacity:1,fillOpacity:1};const travelDotOptions={radius:8,fillColor:route.color||'#e91e63',color:'#fff',weight:2,opacity:1,fillOpacity:1,className:isAnimating?'travel-dot pulsing':'travel-dot'};console.log('RouteVisualizer rendering:',{routeName:route.name,pathLength:validPath.length,locationsLength:validLocations.length,isAnimating,animationProgress});return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Polyline,{positions:visiblePath,...polylineOptions}),validLocations.map((location,index)=>/*#__PURE__*/_jsx(Circle,{center:location.coordinates,...stationCircleOptions},`station-${index}`)),travelDotPosition&&/*#__PURE__*/_jsx(Circle,{center:travelDotPosition,...travelDotOptions})]});};export default RouteVisualizer;","map":{"version":3,"names":["React","useState","useEffect","Polyline","Circle","jsx","_jsx","Fragment","_Fragment","jsxs","_jsxs","RouteVisualizer","_ref","route","isAnimating","setIsAnimating","animationProgress","setAnimationProgress","extractCoordinates","coord","Array","isArray","length","lat","parseFloat","lng","isNaN","console","warn","undefined","getValidPath","path","validPath","map","filter","log","getValidLocations","locations","validLocations","location","coords","coordinates","duration","startTime","Date","now","animate","elapsed","progress","Math","min","requestAnimationFrame","getVisiblePath","fullPath","visiblePointCount","floor","slice","max","getTravelDotPosition","targetIndex","error","visiblePath","travelDotPosition","polylineOptions","color","weight","opacity","lineJoin","dashArray","className","stationCircleOptions","radius","fillColor","fillOpacity","travelDotOptions","routeName","name","pathLength","locationsLength","children","positions","index","center"],"sources":["D:/MY projects/CupeKG/cupe-kg-frontend/src/components/RouteVisualizer/RouteVisualizer.jsx"],"sourcesContent":["// Replace your RouteVisualizer component with this fixed version\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { Polyline, Circle } from 'react-leaflet';\r\n\r\nconst RouteVisualizer = ({ route }) => {\r\n  const [isAnimating, setIsAnimating] = useState(false);\r\n  const [animationProgress, setAnimationProgress] = useState(0);\r\n\r\n  // Helper function to safely extract coordinates\r\n  const extractCoordinates = (coord) => {\r\n    if (!coord) return null;\r\n    \r\n    // Handle different coordinate formats\r\n    if (Array.isArray(coord) && coord.length >= 2) {\r\n      // Ensure coordinates are numbers\r\n      const lat = parseFloat(coord[0]);\r\n      const lng = parseFloat(coord[1]);\r\n      \r\n      // Validate coordinates\r\n      if (isNaN(lat) || isNaN(lng)) {\r\n        console.warn('Invalid coordinates:', coord);\r\n        return null;\r\n      }\r\n      \r\n      return [lat, lng];\r\n    }\r\n    \r\n    if (coord.lat !== undefined && coord.lng !== undefined) {\r\n      const lat = parseFloat(coord.lat);\r\n      const lng = parseFloat(coord.lng);\r\n      \r\n      if (isNaN(lat) || isNaN(lng)) {\r\n        console.warn('Invalid coordinates:', coord);\r\n        return null;\r\n      }\r\n      \r\n      return [lat, lng];\r\n    }\r\n    \r\n    console.warn('Unknown coordinate format:', coord);\r\n    return null;\r\n  };\r\n\r\n  // Convert route path to valid coordinates\r\n  const getValidPath = () => {\r\n    if (!route || !route.path) {\r\n      console.warn('Route or route.path is missing');\r\n      return [];\r\n    }\r\n    \r\n    const validPath = route.path\r\n      .map(coord => extractCoordinates(coord))\r\n      .filter(coord => coord !== null);\r\n    \r\n    console.log('Original path:', route.path);\r\n    console.log('Valid path:', validPath);\r\n    \r\n    return validPath;\r\n  };\r\n\r\n  // Convert route locations to valid coordinates\r\n  const getValidLocations = () => {\r\n    if (!route || !route.locations) {\r\n      console.warn('Route or route.locations is missing');\r\n      return [];\r\n    }\r\n    \r\n    const validLocations = route.locations\r\n      .map(location => {\r\n        const coords = extractCoordinates(location.coordinates);\r\n        return coords ? { ...location, coordinates: coords } : null;\r\n      })\r\n      .filter(location => location !== null);\r\n    \r\n    console.log('Original locations:', route.locations);\r\n    console.log('Valid locations:', validLocations);\r\n    \r\n    return validLocations;\r\n  };\r\n\r\n  // Animation effect\r\n  useEffect(() => {\r\n    if (!route) return;\r\n    \r\n    setIsAnimating(true);\r\n    const duration = 3000; // 3 seconds\r\n    const startTime = Date.now();\r\n    \r\n    const animate = () => {\r\n      const elapsed = Date.now() - startTime;\r\n      const progress = Math.min(elapsed / duration, 1);\r\n      \r\n      setAnimationProgress(progress);\r\n      \r\n      if (progress < 1) {\r\n        requestAnimationFrame(animate);\r\n      } else {\r\n        setIsAnimating(false);\r\n      }\r\n    };\r\n    \r\n    animate();\r\n  }, [route]);\r\n\r\n  // Get visible path based on animation progress\r\n  const getVisiblePath = () => {\r\n    const fullPath = getValidPath();\r\n    if (fullPath.length === 0) return [];\r\n    \r\n    if (!isAnimating) return fullPath;\r\n    \r\n    const visiblePointCount = Math.floor(fullPath.length * animationProgress);\r\n    return fullPath.slice(0, Math.max(visiblePointCount, 1));\r\n  };\r\n\r\n  // Get travel dot position\r\n  const getTravelDotPosition = () => {\r\n    const fullPath = getValidPath();\r\n    if (fullPath.length === 0 || !isAnimating) return null;\r\n    \r\n    const targetIndex = Math.floor((fullPath.length - 1) * animationProgress);\r\n    return fullPath[targetIndex];\r\n  };\r\n\r\n  if (!route) {\r\n    console.warn('RouteVisualizer: No route provided');\r\n    return null;\r\n  }\r\n\r\n  const validPath = getValidPath();\r\n  const validLocations = getValidLocations();\r\n  \r\n  if (validPath.length === 0) {\r\n    console.error('RouteVisualizer: No valid path coordinates found');\r\n    return null;\r\n  }\r\n\r\n  const visiblePath = getVisiblePath();\r\n  const travelDotPosition = getTravelDotPosition();\r\n\r\n  // Define styles\r\n  const polylineOptions = {\r\n    color: route.color || '#e91e63',\r\n    weight: 4,\r\n    opacity: 0.8,\r\n    lineJoin: 'round',\r\n    dashArray: route.dashArray || null,\r\n    className: 'route-path'\r\n  };\r\n\r\n  const stationCircleOptions = {\r\n    radius: 6,\r\n    fillColor: '#fff',\r\n    color: route.color || '#e91e63',\r\n    weight: 2,\r\n    opacity: 1,\r\n    fillOpacity: 1\r\n  };\r\n\r\n  const travelDotOptions = {\r\n    radius: 8,\r\n    fillColor: route.color || '#e91e63',\r\n    color: '#fff',\r\n    weight: 2,\r\n    opacity: 1,\r\n    fillOpacity: 1,\r\n    className: isAnimating ? 'travel-dot pulsing' : 'travel-dot'\r\n  };\r\n\r\n  console.log('RouteVisualizer rendering:', {\r\n    routeName: route.name,\r\n    pathLength: validPath.length,\r\n    locationsLength: validLocations.length,\r\n    isAnimating,\r\n    animationProgress\r\n  });\r\n\r\n  return (\r\n    <>\r\n      {/* The route path */}\r\n      <Polyline positions={visiblePath} {...polylineOptions} />\r\n      \r\n      {/* Location dots along the route */}\r\n      {validLocations.map((location, index) => (\r\n        <Circle \r\n          key={`station-${index}`}\r\n          center={location.coordinates} \r\n          {...stationCircleOptions}\r\n        />\r\n      ))}\r\n      \r\n      {/* Moving travel dot */}\r\n      {travelDotPosition && (\r\n        <Circle \r\n          center={travelDotPosition} \r\n          {...travelDotOptions}\r\n        />\r\n      )}\r\n    </>\r\n  );\r\n};\r\n\r\nexport default RouteVisualizer;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}